<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Assistant</title>
</head>
<body>
    <h1>Mental Health Assistant</h1>

    <textarea id="userInput" rows="4" cols="50" placeholder="How are you feeling?"></textarea><br>
    <button onclick="analyze()">Submit</button>

    <h3>Detected Emotions:</h3>
    <pre id="emotions"></pre>

    <h3>LLM Response:</h3>
    <p id="response"></p>

    <h3>Select Camera:</h3>
    <select id="cameraSelect" onchange="changeCamera()">
        {% for cam in cameras %}
            <option value="{{ cam }}">Camera {{ cam }}</option>
        {% endfor %}
    </select>

    <h3>Live Emotion Detection (Webcam)</h3>
    <img id="videoFeed" src="/video_feed/0" width="480" height="360" />

    <script>
        async function analyze() {
            const text = document.getElementById("userInput").value;
            if (!text.trim()) {
                alert("Please enter how you feel.");
                return;
            }

            try {
                const res = await fetch("/analyze", {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await res.json();
                document.getElementById("emotions").innerText = JSON.stringify(data.emotions, null, 2);
                document.getElementById("response").innerText = data.response || "⚠️ No LLM response received.";
            } catch (error) {
                console.error("Error analyzing text:", error);
                document.getElementById("response").innerText = "⚠️ Error analyzing text.";
            }
        }

        function changeCamera() {
            const camId = document.getElementById("cameraSelect").value;
            const video = document.getElementById("videoFeed");
            video.src = `/video_feed/${camId}`;
        }
    </script>
</body>
</html>
